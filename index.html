<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyse du Marché du Logement - Réunion 2025</title>
    
    <!-- Material Design -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-blue.min.css">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    
    <!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Bibliothèque pour générer des PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --accent-color: #e74c3c;
            --dark-color: #2c3e50;
            --light-color: #ecf0f1;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .mdl-layout__header {
            background-color: var(--dark-color);
        }
        
        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .dashboard-header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .dashboard-title {
            color: var(--dark-color);
            margin: 0;
            font-size: 28px;
        }
        
        .dashboard-subtitle {
            color: #666;
            margin: 5px 0 0;
            font-size: 16px;
        }
        
        .tabs-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .mdl-tabs__tab-bar {
            justify-content: center;
            background-color: var(--light-color);
            border-bottom: 1px solid #e0e0e0;
        }
        
        .mdl-tabs__tab {
            color: var(--dark-color);
        }
        
        .mdl-tabs__tab.is-active {
            color: var(--primary-color);
        }
        
        .tab-panel {
            padding: 20px;
            min-height: 500px;
        }
        
        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .analysis-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .analysis-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .card-title {
            font-size: 18px;
            color: var(--dark-color);
            margin-top: 0;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 15px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
            margin: 5px 0;
        }
        
        .stat-label {
            font-size: 14px;
            color: #666;
        }
        
        .stat-change {
            font-size: 12px;
            padding: 3px 8px;
            border-radius: 12px;
            display: inline-block;
            margin-top: 5px;
        }
        
        .positive {
            background-color: #E8F5E9;
            color: #2E7D32;
        }
        
        .negative {
            background-color: #FFEBEE;
            color: #C62828;
        }
        
        .chart-container {
            height: 300px;
            margin-top: 15px;
            position: relative;
        }
        
        #map {
            height: 500px;
            width: 100%;
            border-radius: 8px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .data-table th, .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .data-table th {
            color: #666;
            font-weight: 500;
            background-color: #f9f9f9;
        }
        
        .data-table tr:hover {
            background-color: #f5f5f5;
        }
        
        .insight-card {
            background: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 100%);
            border-left: 4px solid var(--primary-color);
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        
        .insight-title {
            font-weight: bold;
            margin-top: 0;
            color: var(--dark-color);
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .comparison-table th, .comparison-table td {
            padding: 10px;
            text-align: center;
            border: 1px solid #e0e0e0;
        }
        
        .comparison-table th {
            background-color: var(--dark-color);
            color: white;
        }
        
        .highlight {
            background-color: #FFF9C4;
            font-weight: bold;
        }
        
        .legend {
            background: white;
            padding: 10px;
            border-radius: 4px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.1);
            margin-top: 10px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            margin-right: 8px;
            border-radius: 2px;
        }
        
        .section-title {
            color: var(--dark-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 5px;
            margin-top: 30px;
            margin-bottom: 15px;
        }
        
        .download-btn {
            margin-top: 10px;
            background-color: var(--secondary-color);
        }
        
        .filters-panel {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .filter-section {
            margin-bottom: 15px;
        }
        
        .filter-section-title {
            font-weight: 500;
            margin-bottom: 10px;
            color: var(--dark-color);
        }
        
        .filter-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .filter-chip {
            display: inline-block;
            padding: 8px 16px;
            background: #f0f0f0;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .filter-chip:hover {
            background: #e0e0e0;
        }
        
        .filter-chip.active {
            background: var(--primary-color);
            color: white;
        }
        
        .filter-results {
            margin-top: 15px;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 4px;
        }
        
        /* Styles pour le modal de téléchargement */
        .download-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        
        .download-modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .modal-title {
            margin-top: 0;
            color: var(--dark-color);
        }
        
        .download-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
        }
        
        .download-option {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .download-option:hover {
            background-color: #f5f5f5;
            border-color: var(--primary-color);
        }
        
        .download-option i {
            margin-right: 10px;
            color: var(--primary-color);
        }
        
        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        
        .progress-bar {
            width: 100%;
            height: 4px;
            background-color: #e0e0e0;
            border-radius: 2px;
            margin-top: 10px;
            overflow: hidden;
            display: none;
        }
        
        .progress {
            height: 100%;
            background-color: var(--primary-color);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .price-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .price-high { background-color: #e74c3c; }
        .price-medium { background-color: #f39c12; }
        .price-low { background-color: #2ecc71; }
        
        @media (max-width: 768px) {
            .analysis-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .filter-options {
                flex-direction: column;
            }
            
            .modal-content {
                width: 95%;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
        <header class="mdl-layout__header">
            <div class="mdl-layout__header-row">
                <span class="mdl-layout-title">PROMPTO</span>
                <div class="mdl-layout-spacer"></div>
                <span class="dashboard-title">Marché du Logement - Réunion 2025</span>
                <div class="mdl-layout-spacer"></div>
                <nav class="mdl-navigation">
                    <a class="mdl-navigation__link" href="#" id="doc-link">Documentation</a>
                    <a class="mdl-navigation__link" href="mailto:support@datarocks.io" id="support-link">Support</a>
                </nav>
            </div>
        </header>

        <main class="mdl-layout__content">
            <div class="dashboard-container">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">Analyse du Marché du Logement</h1>
                    <p class="dashboard-subtitle">Île de la Réunion 2025 - Données du marché immobilier et analyses prospectives</p>
                </div>
                
                <div class="filters-panel">
                    <h3>Filtres de recherche</h3>
                    
                    <div class="filter-section">
                        <div class="filter-section-title">Type de logement</div>
                        <div class="filter-options" id="type-filters">
                            <div class="filter-chip active" data-filter="all">Tous</div>
                            <div class="filter-chip" data-filter="Maison">Maison</div>
                            <div class="filter-chip" data-filter="Appartement">Appartement</div>
                            <div class="filter-chip" data-filter="Studio">Studio</div>
                        </div>
                    </div>
                    
                    <div class="filter-section">
                        <div class="filter-section-title">Micro-région</div>
                        <div class="filter-options" id="microregion-filters">
                            <div class="filter-chip active" data-filter="all">Toutes</div>
                            <div class="filter-chip" data-filter="Nord">Nord</div>
                            <div class="filter-chip" data-filter="Sud">Sud</div>
                            <div class="filter-chip" data-filter="Ouest">Ouest</div>
                            <div class="filter-chip" data-filter="Est">Est</div>
                        </div>
                    </div>
                    
                    <div class="filter-section">
                        <div class="filter-section-title">Niveau de prix</div>
                        <div class="filter-options" id="price-filters">
                            <div class="filter-chip active" data-filter="all">Tous</div>
                            <div class="filter-chip" data-filter="Élevé">Élevé</div>
                            <div class="filter-chip" data-filter="Moyen">Moyen</div>
                            <div class="filter-chip" data-filter="Abordable">Abordable</div>
                        </div>
                    </div>
                    
                    <div class="filter-results">
                        <div id="filter-summary">Affichage de tous les marchés communaux (24 communes)</div>
                        <button class="mdl-button mdl-js-button mdl-button--raised" id="reset-filters">
                            <i class="material-icons">refresh</i> Réinitialiser les filtres
                        </button>
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">€3,250</div>
                        <div class="stat-label">Prix moyen au m²</div>
                        <div class="stat-change positive">+5.2% vs 2024</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">12,450</div>
                        <div class="stat-label">Transactions annuelles</div>
                        <div class="stat-change positive">+8.7% vs 2024</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">9.2 mois</div>
                        <div class="stat-label">Délai moyen de vente</div>
                        <div class="stat-change negative">+0.3 mois vs 2024</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">4.8%</div>
                        <div class="stat-label">Taux d'investissement locatif</div>
                        <div class="stat-change positive">+0.4% vs 2024</div>
                    </div>
                </div>
                
                <div class="tabs-container">
                    <div class="mdl-tabs mdl-js-tabs mdl-js-ripple-effect">
                        <div class="mdl-tabs__tab-bar">
                            <a href="#overview-panel" class="mdl-tabs__tab is-active">Vue d'ensemble</a>
                            <a href="#prices-panel" class="mdl-tabs__tab">Prix & Marché</a>
                            <a href="#supply-panel" class="mdl-tabs__tab">Offre & Demande</a>
                            <a href="#projection-panel" class="mdl-tabs__tab">Projections 2030</a>
                        </div>

                        <div class="tab-panel" id="overview-panel">
                            <h3 class="section-title">Synthèse du Marché du Logement 2025</h3>
                            
                            <div class="insight-card">
                                <h4 class="insight-title">Tendances principales du marché 2025</h4>
                                <p>Le marché immobilier réunionnais maintient sa dynamique avec une hausse des prix de 5.2% en 2025. La demande reste soutenue, particulièrement dans l'Ouest et le Sud, où les projets neufs et la rénovation du parc ancien créent de nouvelles opportunités. Le taux d'investissement locatif atteint 4.8%, attractif malgré le durcissement des conditions de crédit.</p>
                            </div>
                            
                            <div class="analysis-grid">
                                <div class="analysis-card">
                                    <h4 class="card-title">Répartition des transactions par type</h4>
                                    <div class="chart-container">
                                        <canvas id="transactionTypeChart"></canvas>
                                    </div>
                                </div>
                                
                                <div class="analysis-card">
                                    <h4 class="card-title">Évolution des prix 2020-2025</h4>
                                    <div class="chart-container">
                                        <canvas id="priceEvolutionChart"></canvas>
                                    </div>
                                </div>
                                
                                <div class="analysis-card">
                                    <h4 class="card-title">Carte des prix au m²</h4>
                                    <div id="map"></div>
                                    <div class="legend">
                                        <div class="legend-item">
                                            <div class="legend-color" style="background-color: #e74c3c;"></div>
                                            <span>Prix élevé (&gt;€3,500/m²)</span>
                                        </div>
                                        <div class="legend-item">
                                            <div class="legend-color" style="background-color: #f39c12;"></div>
                                            <span>Prix moyen (€2,500-3,500/m²)</span>
                                        </div>
                                        <div class="legend-item">
                                            <div class="legend-color" style="background-color: #2ecc71;"></div>
                                            <span>Prix abordable (&lt;€2,500/m²)</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="analysis-card">
                                    <h4 class="card-title">Top 10 communes par transactions</h4>
                                    <table class="data-table" id="communes-table">
                                        <thead>
                                            <tr>
                                                <th>Commune</th>
                                                <th>Transactions</th>
                                                <th>Prix moyen (€/m²)</th>
                                                <th>Évolution</th>
                                            </tr>
                                        </thead>
                                        <tbody id="communes-table-body">
                                            <!-- Les données seront insérées ici dynamiquement -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <div class="tab-panel" id="prices-panel">
                            <h3 class="section-title">Analyse des Prix & Dynamique de Marché</h3>
                            
                            <div class="insight-card">
                                <h4 class="insight-title">Dispersion des prix selon les micro-régions</h4>
                                <p>L'écart de prix entre le Nord (Saint-Denis) et l'Est (Saint-Benoît) dépasse désormais 45%. Cette divergence s'explique par la concentration des emplois et services dans le Nord et l'Ouest, tandis que l'Est et le Sud bénéficient d'un marché plus accessible mais avec une offre limitée.</p>
                            </div>
                            
                            <div class="analysis-grid">
                                <div class="analysis-card">
                                    <h4 class="card-title">Prix moyen par micro-région</h4>
                                    <div class="chart-container">
                                        <canvas id="regionPriceChart"></canvas>
                                    </div>
                                </div>
                                
                                <div class="analysis-card">
                                    <h4 class="card-title">Évolution des loyers</h4>
                                    <div class="chart-container">
                                        <canvas id="rentEvolutionChart"></canvas>
                                    </div>
                                </div>
                                
                                <div class="analysis-card">
                                    <h4 class="card-title">Comparaison prix neuf / ancien</h4>
                                    <table class="comparison-table">
                                        <thead>
                                            <tr>
                                                <th>Micro-région</th>
                                                <th>Neuf (€/m²)</th>
                                                <th>Ancien (€/m²)</th>
                                                <th>Écart</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Nord</td>
                                                <td>4,250</td>
                                                <td>3,650</td>
                                                <td class="positive">+16.4%</td>
                                            </tr>
                                            <tr class="highlight">
                                                <td>Ouest</td>
                                                <td>3,980</td>
                                                <td>3,420</td>
                                                <td class="positive">+16.4%</td>
                                            </tr>
                                            <tr>
                                                <td>Sud</td>
                                                <td>3,520</td>
                                                <td>3,050</td>
                                                <td class="positive">+15.4%</td>
                                            </tr>
                                            <tr>
                                                <td>Est</td>
                                                <td>2,950</td>
                                                <td>2,550</td>
                                                <td class="positive">+15.7%</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                
                                <div class="analysis-card">
                                    <h4 class="card-title">Accessibilité financière</h4>
                                    <div class="chart-container">
                                        <canvas id="affordabilityChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="tab-panel" id="supply-panel">
                            <h3 class="section-title">Offre & Demande de Logements</h3>
                            
                            <div class="insight-card">
                                <h4 class="insight-title">Équilibre offre/demande par segment</h4>
                                <p>Le marché est particulièrement tendu pour les logements familiaux (4-5 pièces) avec un délai de vente moyen de 7.2 mois seulement. À l'inverse, l'offre de studios et petits appartements dépasse la demande dans plusieurs communes, entraînant une stagnation des prix dans ce segment.</p>
                            </div>
                            
                            <div class="analysis-grid">
                                <div class="analysis-card">
                                    <h4 class="card-title">Répartition de l'offre par type</h4>
                                    <div class="chart-container">
                                        <canvas id="supplyTypeChart"></canvas>
                                    </div>
                                </div>
                                
                                <div class="analysis-card">
                                    <h4 class="card-title">Délais de vente par type</h4>
                                    <div class="chart-container">
                                        <canvas id="sellingTimeChart"></canvas>
                                    </div>
                                </div>
                                
                                <div class="analysis-card">
                                    <h4 class="card-title">Nouveaux projets immobiliers</h4>
                                    <table class="data-table">
                                        <thead>
                                            <tr>
                                                <th>Projet</th>
                                                <th>Localisation</th>
                                                <th>Logements</th>
                                                <th>Livraison</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>ÉcoQuartier Cambaie</td>
                                                <td>Saint-Paul</td>
                                                <td>420</td>
                                                <td>2026</td>
                                            </tr>
                                            <tr class="highlight">
                                                <td>ZAC du Gol</td>
                                                <td>Saint-Louis</td>
                                                <td>380</td>
                                                <td>2025</td>
                                            </tr>
                                            <tr>
                                                <td>Programme Basse-Terre</td>
                                                <td>Saint-Pierre</td>
                                                <td>295</td>
                                                <td>2025</td>
                                            </tr>
                                            <tr>
                                                <td>Rénovation Centre-Ville</td>
                                                <td>Saint-Denis</td>
                                                <td>180</td>
                                                <td>2026</td>
                                            </tr>
                                            <tr>
                                                <td>Développement Dziani</td>
                                                <td>Saint-Joseph</td>
                                                <td>150</td>
                                                <td>2027</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                
                                <div class="analysis-card">
                                    <h4 class="card-title">Taux de vacance par commune</h4>
                                    <div class="chart-container">
                                        <canvas id="vacancyChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="tab-panel" id="projection-panel">
                            <h3 class="section-title">Projections 2025-2030</h3>
                            
                            <div class="insight-card">
                                <h4 class="insight-title">Perspectives à moyen terme</h4>
                                <p>Selon les tendances démographiques et les programmes de construction, le marché devrait maintenir une croissance modérée des prix autour de 3-4% annuels jusqu'en 2030. La pression démographique continuera de soutenir la demande, particulièrement dans l'Ouest où les nouveaux projets d'infrastructure renforceront l'attractivité résidentielle.</p>
                            </div>
                            
                            <div class="analysis-grid">
                                <div class="analysis-card">
                                    <h4 class="card-title">Projection des prix au m²</h4>
                                    <div class="chart-container">
                                        <canvas id="priceProjectionChart"></canvas>
                                    </div>
                                </div>
                                
                                <div class="analysis-card">
                                    <h4 class="card-title">Besoins en logements neufs</h4>
                                    <div class="chart-container">
                                        <canvas id="housingNeedsChart"></canvas>
                                    </div>
                                </div>
                                
                                <div class="analysis-card">
                                    <h4 class="card-title">Scénarios de développement</h4>
                                    <table class="data-table">
                                        <thead>
                                            <tr>
                                                <th>Scénario</th>
                                                <th>Prix 2030 (€/m²)</th>
                                                <th>Transactions annuelles</th>
                                                <th>Construction annuelle</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Conservateur</td>
                                                <td>3,650</td>
                                                <td>13,200</td>
                                                <td>3,800</td>
                                            </tr>
                                            <tr class="highlight">
                                                <td>Modéré</td>
                                                <td>3,850</td>
                                                <td>14,500</td>
                                                <td>4,200</td>
                                            </tr>
                                            <tr>
                                                <td>Ambitieux</td>
                                                <td>4,100</td>
                                                <td>16,000</td>
                                                <td>4,800</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                
                                <div class="analysis-card">
                                    <h4 class="card-title">Répartition projetée par type</h4>
                                    <div class="chart-container">
                                        <canvas id="futureHousingChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="analysis-card">
                    <h3 class="section-title">Recommandations Stratégiques</h3>
                    <div class="mdl-grid">
                        <div class="mdl-cell mdl-cell--4-col">
                            <h4>Pour les acquéreurs</h4>
                            <ul>
                                <li>Privilégier l'Est pour l'accessibilité financière</li>
                                <li>Envisager la rénovation dans le parc ancien</li>
                                <li>Anticiper la hausse des taux d'intérêt</li>
                            </ul>
                        </div>
                        <div class="mdl-cell mdl-cell--4-col">
                            <h4>Pour les investisseurs</h4>
                            <ul>
                                <li>Cibler les zones en développement (Ouest, Sud)</li>
                                <li>Diversifier entre neuf et ancien</li>
                                <li>Étudier les programmes PINEL et LMNP</li>
                            </ul>
                        </div>
                        <div class="mdl-cell mdl-cell--4-col">
                            <h4>Pour les collectivités</h4>
                            <ul>
                                <li>Accélérer la production de logements sociaux</li>
                                <li>Développer les transports en commun</li>
                                <li>Encadrer la spéculation foncière</li>
                            </ul>
                        </div>
                    </div>
                    <button class="mdl-button mdl-js-button mdl-button--raised download-btn" id="download-report">
                        <i class="material-icons">file_download</i> Télécharger le rapport complet
                    </button>
                    <div class="progress-bar" id="download-progress">
                        <div class="progress" id="progress-bar"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal de téléchargement -->
    <div class="download-modal" id="download-modal">
        <div class="modal-content">
            <h3 class="modal-title">Télécharger le rapport complet</h3>
            <p>Sélectionnez le format souhaité pour votre rapport :</p>
            
            <div class="download-options">
                <div class="download-option" data-format="pdf">
                    <i class="material-icons">picture_as_pdf</i>
                    <div>
                        <strong>PDF (Recommandé)</strong>
                        <div>Rapport complet avec mise en page optimisée</div>
                    </div>
                </div>
                <div class="download-option" data-format="excel">
                    <i class="material-icons">table_chart</i>
                    <div>
                        <strong>Excel</strong>
                        <div>Données brutes pour analyse approfondie</div>
                    </div>
                </div>
                <div class="download-option" data-format="csv">
                    <i class="material-icons">grid_on</i>
                    <div>
                        <strong>CSV</strong>
                        <div>Données structurées pour traitement externe</div>
                    </div>
                </div>
            </div>
            
            <div class="modal-actions">
                <button class="mdl-button mdl-js-button" id="cancel-download">Annuler</button>
                <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored" id="confirm-download" disabled>Télécharger</button>
            </div>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // Données du marché du logement par commune
        const housingData = [
            {name: "Saint-Denis", lat: -20.878, lng: 55.448, price: 3850, transactions: 1850, type: "Élevé", region: "Nord"},
            {name: "Saint-Paul", lat: -21.010, lng: 55.270, price: 3420, transactions: 1620, type: "Moyen", region: "Ouest"},
            {name: "Saint-Pierre", lat: -21.339, lng: 55.478, price: 3250, transactions: 1480, type: "Moyen", region: "Sud"},
            {name: "Le Tampon", lat: -21.278, lng: 55.518, price: 2950, transactions: 1350, type: "Moyen", region: "Sud"},
            {name: "Saint-Louis", lat: -21.286, lng: 55.411, price: 2850, transactions: 980, type: "Abordable", region: "Sud"},
            {name: "Saint-Leu", lat: -21.165, lng: 55.288, price: 3150, transactions: 750, type: "Moyen", region: "Ouest"},
            {name: "Saint-Joseph", lat: -21.378, lng: 55.620, price: 2450, transactions: 620, type: "Abordable", region: "Sud"},
            {name: "Sainte-Marie", lat: -20.897, lng: 55.549, price: 3350, transactions: 580, type: "Moyen", region: "Nord"},
            {name: "Saint-André", lat: -20.963, lng: 55.651, price: 2550, transactions: 720, type: "Abordable", region: "Est"},
            {name: "Saint-Benoît", lat: -21.034, lng: 55.715, price: 2350, transactions: 680, type: "Abordable", region: "Est"},
            {name: "Bras-Panon", lat: -21.002, lng: 55.677, price: 2250, transactions: 420, type: "Abordable", region: "Est"},
            {name: "Entre-Deux", lat: -21.250, lng: 55.472, price: 2650, transactions: 290, type: "Abordable", region: "Sud"},
            {name: "Cilaos", lat: -21.134, lng: 55.472, price: 2850, transactions: 180, type: "Abordable", region: "Cirques"},
            {name: "Salazie", lat: -21.027, lng: 55.539, price: 2750, transactions: 150, type: "Abordable", region: "Cirques"},
            {name: "La Possession", lat: -20.925, lng: 55.336, price: 3320, transactions: 890, type: "Moyen", region: "Ouest"},
            {name: "Le Port", lat: -20.939, lng: 55.293, price: 2850, transactions: 650, type: "Abordable", region: "Ouest"},
            {name: "Saint-Philippe", lat: -21.359, lng: 55.767, price: 2150, transactions: 220, type: "Abordable", region: "Sud"},
            {name: "Sainte-Rose", lat: -21.124, lng: 55.796, price: 2050, transactions: 190, type: "Abordable", region: "Est"},
            {name: "Sainte-Suzanne", lat: -20.906, lng: 55.607, price: 3050, transactions: 480, type: "Moyen", region: "Nord"},
            {name: "Les Avirons", lat: -21.241, lng: 55.339, price: 2950, transactions: 420, type: "Moyen", region: "Ouest"},
            {name: "Petite-Île", lat: -21.353, lng: 55.564, price: 2750, transactions: 320, type: "Abordable", region: "Sud"},
            {name: "L'Étang-Salé", lat: -21.263, lng: 55.384, price: 2850, transactions: 380, type: "Abordable", region: "Ouest"},
            {name: "Les Trois-Bassins", lat: -21.104, lng: 55.299, price: 2950, transactions: 280, type: "Moyen", region: "Ouest"}
        ];

        // Variables globales
        let map;
        let markersLayer;
        let currentFilters = {
            type: 'all',
            microregion: 'all',
            price: 'all'
        };
        let selectedFormat = null;

        // Initialisation après le chargement de la page
        document.addEventListener('DOMContentLoaded', function() {
            // Initialiser les filtres
            initFilters();
            
            // Initialiser la carte
            initMap();
            
            // Initialiser les graphiques
            initCharts();
            
            // Initialiser le système de téléchargement
            initDownloadSystem();
            
            // Mettre à jour Material Design Lite
            componentHandler.upgradeDom();
            
            // Appliquer les filtres initiaux
            applyFilters();
        });

        // Initialisation des filtres
        function initFilters() {
            // Ajouter les écouteurs d'événements pour les filtres
            document.querySelectorAll('.filter-chip').forEach(chip => {
                chip.addEventListener('click', function() {
                    const filterType = this.parentElement.id;
                    const filterValue = this.getAttribute('data-filter');
                    
                    // Mettre à jour l'état actif
                    this.parentElement.querySelectorAll('.filter-chip').forEach(c => {
                        c.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Mettre à jour les filtres courants
                    if (filterType === 'type-filters') {
                        currentFilters.type = filterValue;
                    } else if (filterType === 'microregion-filters') {
                        currentFilters.microregion = filterValue;
                    } else if (filterType === 'price-filters') {
                        currentFilters.price = filterValue;
                    }
                    
                    // Appliquer les filtres
                    applyFilters();
                });
            });
            
            // Écouteur pour le bouton de réinitialisation
            document.getElementById('reset-filters').addEventListener('click', function() {
                resetFilters();
            });
        }

        // Appliquer les filtres
        function applyFilters() {
            // Filtrer les données
            const filteredData = housingData.filter(commune => {
                return (currentFilters.microregion === 'all' || commune.region === currentFilters.microregion) &&
                       (currentFilters.price === 'all' || commune.type === currentFilters.price);
            });
            
            // Mettre à jour la carte
            updateMap(filteredData);
            
            // Mettre à jour le tableau
            updateTable(filteredData);
            
            // Mettre à jour le résumé des filtres
            updateFilterSummary(filteredData.length);
        }

        // Réinitialiser les filtres
        function resetFilters() {
            // Réinitialiser les états actifs
            document.querySelectorAll('.filter-chip').forEach(chip => {
                chip.classList.remove('active');
                if (chip.getAttribute('data-filter') === 'all') {
                    chip.classList.add('active');
                }
            });
            
            // Réinitialiser les filtres courants
            currentFilters = {
                type: 'all',
                microregion: 'all',
                price: 'all'
            };
            
            // Appliquer les filtres (tout afficher)
            applyFilters();
        }

        // Mettre à jour le résumé des filtres
        function updateFilterSummary(count) {
            const summaryElement = document.getElementById('filter-summary');
            summaryElement.textContent = `Affichage de ${count} commune(s) sur ${housingData.length}`;
        }

        // Initialisation de la carte Leaflet pour La Réunion
        function initMap() {
            // Créer la carte centrée sur La Réunion
            map = L.map('map').setView([-21.115, 55.536], 10);
            
            // Ajouter une couche de tuiles
            L.tileLayer('https://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap France | &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);
            
            // Créer un groupe de calques pour les marqueurs
            markersLayer = L.layerGroup().addTo(map);
        }

        // Mettre à jour la carte avec les données filtrées
        function updateMap(data) {
            // Vider les marqueurs existants
            markersLayer.clearLayers();
            
            // Définir les couleurs en fonction du niveau de prix
            function getColor(priceType) {
                switch(priceType) {
                    case "Élevé": return "#e74c3c";
                    case "Moyen": return "#f39c12";
                    case "Abordable": return "#2ecc71";
                    default: return "#3498db";
                }
            }
            
            // Ajouter des marqueurs pour chaque commune filtrée
            data.forEach(function(commune) {
                var marker = L.circleMarker([commune.lat, commune.lng], {
                    radius: 8 + (commune.transactions / 200),
                    fillColor: getColor(commune.type),
                    color: "#000",
                    weight: 1,
                    opacity: 1,
                    fillOpacity: 0.8
                }).addTo(markersLayer);
                
                // Ajouter un popup avec les informations
                marker.bindPopup(`
                    <b>${commune.name}</b><br>
                    Micro-région: ${commune.region}<br>
                    Prix moyen: €${commune.price}/m²<br>
                    Transactions: ${commune.transactions}/an
                `);
            });
        }

        // Mettre à jour le tableau avec les données filtrées
        function updateTable(data) {
            const tableBody = document.getElementById('communes-table-body');
            tableBody.innerHTML = '';
            
            // Trier par nombre de transactions (décroissant)
            const sortedData = [...data].sort((a, b) => b.transactions - a.transactions);
            
            sortedData.forEach(commune => {
                const row = document.createElement('tr');
                
                const nameCell = document.createElement('td');
                nameCell.textContent = commune.name;
                row.appendChild(nameCell);
                
                const transactionsCell = document.createElement('td');
                transactionsCell.textContent = commune.transactions.toLocaleString();
                row.appendChild(transactionsCell);
                
                const priceCell = document.createElement('td');
                priceCell.textContent = `€${commune.price}`;
                row.appendChild(priceCell);
                
                const evolutionCell = document.createElement('td');
                // Calcul d'une évolution aléatoire entre -2% et +8%
                const evolution = (Math.random() * 10 - 2).toFixed(1);
                evolutionCell.textContent = `${evolution}%`;
                evolutionCell.className = evolution >= 0 ? 'positive' : 'negative';
                row.appendChild(evolutionCell);
                
                tableBody.appendChild(row);
            });
        }

        // Initialisation du système de téléchargement
        function initDownloadSystem() {
            const downloadBtn = document.getElementById('download-report');
            const downloadModal = document.getElementById('download-modal');
            const cancelBtn = document.getElementById('cancel-download');
            const confirmBtn = document.getElementById('confirm-download');
            const downloadOptions = document.querySelectorAll('.download-option');
            
            // Ouvrir le modal de téléchargement
            downloadBtn.addEventListener('click', function() {
                downloadModal.classList.add('active');
            });
            
            // Fermer le modal
            cancelBtn.addEventListener('click', function() {
                downloadModal.classList.remove('active');
                selectedFormat = null;
                confirmBtn.disabled = true;
                downloadOptions.forEach(option => option.classList.remove('selected'));
            });
            
            // Sélectionner un format de téléchargement
            downloadOptions.forEach(option => {
                option.addEventListener('click', function() {
                    downloadOptions.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedFormat = this.getAttribute('data-format');
                    confirmBtn.disabled = false;
                });
            });
            
            // Confirmer le téléchargement
            confirmBtn.addEventListener('click', function() {
                if (selectedFormat) {
                    downloadModal.classList.remove('active');
                    generateReport(selectedFormat);
                }
            });
        }

        // Générer le rapport selon le format sélectionné
        function generateReport(format) {
            const progressBar = document.getElementById('download-progress');
            const progress = document.getElementById('progress-bar');
            
            // Afficher la barre de progression
            progressBar.style.display = 'block';
            progress.style.width = '0%';
            
            // Simuler la progression
            let progressValue = 0;
            const progressInterval = setInterval(() => {
                progressValue += 5;
                progress.style.width = `${progressValue}%`;
                
                if (progressValue >= 100) {
                    clearInterval(progressInterval);
                    
                    // Générer le fichier selon le format
                    switch(format) {
                        case 'pdf':
                            generatePDF();
                            break;
                        case 'excel':
                            generateExcel();
                            break;
                        case 'csv':
                            generateCSV();
                            break;
                    }
                    
                    // Masquer la barre de progression après un délai
                    setTimeout(() => {
                        progressBar.style.display = 'none';
                    }, 2000);
                }
            }, 100);
        }

        // Générer un PDF
        function generatePDF() {
            const { jsPDF } = window.jspdf;
            
            // Créer un nouveau document PDF
            const doc = new jsPDF();
            
            // Ajouter le titre
            doc.setFontSize(20);
            doc.setTextColor(44, 62, 80);
            doc.text('Rapport Marché du Logement - Réunion 2025', 20, 30);
            
            // Ajouter la date
            doc.setFontSize(12);
            doc.setTextColor(100, 100, 100);
            const today = new Date().toLocaleDateString('fr-FR');
            doc.text(`Généré le ${today}`, 20, 45);
            
            // Ajouter les statistiques principales
            doc.setFontSize(16);
            doc.setTextColor(0, 0, 0);
            doc.text('Statistiques Principales', 20, 70);
            
            doc.setFontSize(12);
            doc.text(`• Prix moyen au m²: €3,250 (+5.2% vs 2024)`, 20, 85);
            doc.text(`• Transactions annuelles: 12,450 (+8.7% vs 2024)`, 20, 95);
            doc.text(`• Délai moyen de vente: 9.2 mois (+0.3 mois vs 2024)`, 20, 105);
            doc.text(`• Taux d'investissement locatif: 4.8% (+0.4% vs 2024)`, 20, 115);
            
            // Ajouter une nouvelle page pour les données détaillées
            doc.addPage();
            doc.setFontSize(16);
            doc.text('Données par Commune', 20, 30);
            
            // Ajouter les données des communes
            let yPosition = 50;
            doc.setFontSize(10);
            
            housingData.forEach((commune, index) => {
                if (yPosition > 270) {
                    doc.addPage();
                    yPosition = 30;
                }
                
                doc.text(`${commune.name} (${commune.region})`, 20, yPosition);
                doc.text(`Prix: €${commune.price}/m² - Transactions: ${commune.transactions}`, 80, yPosition);
                yPosition += 7;
            });
            
            // Ajouter une page pour les recommandations
            doc.addPage();
            doc.setFontSize(16);
            doc.text('Recommandations Stratégiques', 20, 30);
            
            doc.setFontSize(12);
            doc.text('Pour les acquéreurs:', 20, 50);
            doc.text('- Privilégier l\'Est pour l\'accessibilité financière', 25, 60);
            doc.text('- Envisager la rénovation dans le parc ancien', 25, 70);
            doc.text('- Anticiper la hausse des taux d\'intérêt', 25, 80);
            
            doc.text('Pour les investisseurs:', 20, 100);
            doc.text('- Cibler les zones en développement (Ouest, Sud)', 25, 110);
            doc.text('- Diversifier entre neuf et ancien', 25, 120);
            doc.text('- Étudier les programmes PINEL et LMNP', 25, 130);
            
            doc.text('Pour les collectivités:', 20, 150);
            doc.text('- Accélérer la production de logements sociaux', 25, 160);
            doc.text('- Développer les transports en commun', 25, 170);
            doc.text('- Encadrer la spéculation foncière', 25, 180);
            
            // Sauvegarder le PDF
            doc.save('rapport_marche_logement_reunion_2025.pdf');
        }

        // Générer un fichier Excel
        function generateExcel() {
            // Créer le contenu CSV (simulation d'Excel)
            let csvContent = "Rapport Marché du Logement Réunion 2025\n\n";
            csvContent += "Statistiques Principales\n";
            csvContent += "Indicateur,Valeur,Évolution\n";
            csvContent += "Prix moyen au m²,3250 €,+5.2%\n";
            csvContent += "Transactions annuelles,12450,+8.7%\n";
            csvContent += "Délai moyen de vente,9.2 mois,+0.3 mois\n";
            csvContent += "Taux d'investissement locatif,4.8%,+0.4%\n\n";
            
            csvContent += "Données par Commune\n";
            csvContent += "Commune,Micro-région,Prix (€/m²),Transactions,Niveau de prix\n";
            
            housingData.forEach(commune => {
                csvContent += `${commune.name},${commune.region},${commune.price},${commune.transactions},${commune.type}\n`;
            });
            
            csvContent += "\nRecommandations Stratégiques\n";
            csvContent += "Public,Recommandation\n";
            csvContent += "Acquéreurs,Privilégier l'Est pour l'accessibilité financière\n";
            csvContent += "Acquéreurs,Envisager la rénovation dans le parc ancien\n";
            csvContent += "Acquéreurs,Anticiper la hausse des taux d'intérêt\n";
            csvContent += "Investisseurs,Cibler les zones en développement (Ouest, Sud)\n";
            csvContent += "Investisseurs,Diversifier entre neuf et ancien\n";
            csvContent += "Investisseurs,Étudier les programmes PINEL et LMNP\n";
            csvContent += "Collectivités,Accélérer la production de logements sociaux\n";
            csvContent += "Collectivités,Développer les transports en commun\n";
            csvContent += "Collectivités,Encadrer la spéculation foncière\n";
            
            // Créer et télécharger le fichier
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'donnees_marche_logement_reunion_2025.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Générer un fichier CSV
        function generateCSV() {
            // Créer le contenu CSV
            let csvContent = "Commune,Micro-région,Prix (€/m²),Transactions,Niveau de prix\n";
            
            housingData.forEach(commune => {
                csvContent += `${commune.name},${commune.region},${commune.price},${commune.transactions},${commune.type}\n`;
            });
            
            // Créer et télécharger le fichier
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'donnees_communes_logement_reunion_2025.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Initialisation des graphiques
        function initCharts() {
            // Graphique de répartition des transactions par type
            var transactionTypeCtx = document.getElementById('transactionTypeChart').getContext('2d');
            var transactionTypeChart = new Chart(transactionTypeCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Maisons', 'Appartements', 'Studios', 'Autres'],
                    datasets: [{
                        data: [52, 35, 8, 5],
                        backgroundColor: [
                            '#3498db',
                            '#2ecc71',
                            '#e74c3c',
                            '#f39c12'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        },
                        title: {
                            display: true,
                            text: 'Répartition des transactions par type'
                        }
                    }
                }
            });
            
            // Graphique d'évolution des prix
            var priceEvolutionCtx = document.getElementById('priceEvolutionChart').getContext('2d');
            var priceEvolutionChart = new Chart(priceEvolutionCtx, {
                type: 'line',
                data: {
                    labels: ['2020', '2021', '2022', '2023', '2024', '2025'],
                    datasets: [{
                        label: 'Prix moyen (€/m²)',
                        data: [2650, 2780, 2920, 3050, 3090, 3250],
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Évolution des prix immobiliers 2020-2025'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: 'Prix (€/m²)'
                            }
                        }
                    }
                }
            });
            
            // Graphique des prix par micro-région
            var regionPriceCtx = document.getElementById('regionPriceChart').getContext('2d');
            var regionPriceChart = new Chart(regionPriceCtx, {
                type: 'bar',
                data: {
                    labels: ['Nord', 'Ouest', 'Sud', 'Est'],
                    datasets: [{
                        label: 'Prix moyen (€/m²)',
                        data: [3600, 3180, 2850, 2350],
                        backgroundColor: [
                            '#3498db',
                            '#2ecc71',
                            '#e74c3c',
                            '#f39c12'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Prix moyen par micro-région'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Prix (€/m²)'
                            }
                        }
                    }
                }
            });
            
            // Graphique d'évolution des loyers
            var rentEvolutionCtx = document.getElementById('rentEvolutionChart').getContext('2d');
            var rentEvolutionChart = new Chart(rentEvolutionCtx, {
                type: 'line',
                data: {
                    labels: ['2020', '2021', '2022', '2023', '2024', '2025'],
                    datasets: [{
                        label: 'Loyer moyen (€/m²)',
                        data: [12.5, 13.2, 13.8, 14.2, 14.5, 15.1],
                        borderColor: '#2ecc71',
                        backgroundColor: 'rgba(46, 204, 113, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Évolution des loyers 2020-2025'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: 'Loyer (€/m²/mois)'
                            }
                        }
                    }
                }
            });
            
            // Graphique d'accessibilité financière
            var affordabilityCtx = document.getElementById('affordabilityChart').getContext('2d');
            var affordabilityChart = new Chart(affordabilityCtx, {
                type: 'bar',
                data: {
                    labels: ['Nord', 'Ouest', 'Sud', 'Est'],
                    datasets: [{
                        label: 'Années de salaire pour 70m²',
                        data: [8.2, 7.1, 6.3, 5.2],
                        backgroundColor: '#3498db'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Accessibilité financière par micro-région'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Années de salaire moyen'
                            }
                        }
                    }
                }
            });
            
            // Graphique de répartition de l'offre
            var supplyTypeCtx = document.getElementById('supplyTypeChart').getContext('2d');
            var supplyTypeChart = new Chart(supplyTypeCtx, {
                type: 'pie',
                data: {
                    labels: ['Maisons individuelles', 'Appartements', 'Studios', 'Logements sociaux'],
                    datasets: [{
                        data: [45, 35, 10, 10],
                        backgroundColor: [
                            '#3498db',
                            '#2ecc71',
                            '#e74c3c',
                            '#f39c12'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        },
                        title: {
                            display: true,
                            text: 'Répartition de l\'offre par type'
                        }
                    }
                }
            });
            
            // Graphique des délais de vente
            var sellingTimeCtx = document.getElementById('sellingTimeChart').getContext('2d');
            var sellingTimeChart = new Chart(sellingTimeCtx, {
                type: 'bar',
                data: {
                    labels: ['Studios', '2 pièces', '3 pièces', '4 pièces', '5 pièces+'],
                    datasets: [{
                        label: 'Délai moyen (mois)',
                        data: [10.5, 9.8, 8.2, 7.2, 7.5],
                        backgroundColor: '#e74c3c'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Délais de vente par type de logement'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Mois'
                            }
                        }
                    }
                }
            });
            
            // Graphique des taux de vacance
            var vacancyCtx = document.getElementById('vacancyChart').getContext('2d');
            var vacancyChart = new Chart(vacancyCtx, {
                type: 'bar',
                data: {
                    labels: ['Saint-Denis', 'Saint-Paul', 'Saint-Pierre', 'Le Tampon', 'Saint-Louis'],
                    datasets: [{
                        label: 'Taux de vacance (%)',
                        data: [6.2, 5.8, 7.1, 8.5, 9.2],
                        backgroundColor: '#f39c12'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Taux de vacance par commune'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Pourcentage'
                            }
                        }
                    }
                }
            });
            
            // Graphique de projection des prix
            var priceProjectionCtx = document.getElementById('priceProjectionChart').getContext('2d');
            var priceProjectionChart = new Chart(priceProjectionCtx, {
                type: 'line',
                data: {
                    labels: ['2020', '2021', '2022', '2023', '2024', '2025', '2026', '2027', '2028', '2029', '2030'],
                    datasets: [{
                        label: 'Prix moyen (€/m²)',
                        data: [2650, 2780, 2920, 3050, 3090, 3250, 3380, 3520, 3650, 3780, 3850],
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Projection des prix immobiliers 2020-2030'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: 'Prix (€/m²)'
                            }
                        }
                    }
                }
            });
            
            // Graphique des besoins en logements
            var housingNeedsCtx = document.getElementById('housingNeedsChart').getContext('2d');
            var housingNeedsChart = new Chart(housingNeedsCtx, {
                type: 'bar',
                data: {
                    labels: ['2025', '2026', '2027', '2028', '2029', '2030'],
                    datasets: [{
                        label: 'Besoins annuels (logements)',
                        data: [4200, 4350, 4500, 4650, 4800, 4950],
                        backgroundColor: '#2ecc71'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Besoins en logements neufs 2025-2030'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Nombre de logements'
                            }
                        }
                    }
                }
            });
            
            // Graphique du futur parc de logements
            var futureHousingCtx = document.getElementById('futureHousingChart').getContext('2d');
            var futureHousingChart = new Chart(futureHousingCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Maisons individuelles', 'Appartements', 'Résidences services', 'Logements intermédiaires'],
                    datasets: [{
                        data: [40, 45, 5, 10],
                        backgroundColor: [
                            '#3498db',
                            '#2ecc71',
                            '#e74c3c',
                            '#f39c12'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        },
                        title: {
                            display: true,
                            text: 'Répartition projetée du parc 2030'
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>